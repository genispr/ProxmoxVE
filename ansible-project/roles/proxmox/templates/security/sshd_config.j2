# SSH daemon configuration template for Proxmox
# Managed by Ansible - DO NOT EDIT MANUALLY

# Basic SSH Configuration
Port {{ security_config.ssh.port | default(22) }}
Protocol 2
AddressFamily any
ListenAddress {{ security_config.ssh.listen_address | default('0.0.0.0') }}

# Authentication
PermitRootLogin {{ security_config.ssh.permit_root_login | default('no') }}
PubkeyAuthentication {{ security_config.ssh.pubkey_auth | default('yes') }}
PasswordAuthentication {{ security_config.ssh.password_auth | default('no') }}
PermitEmptyPasswords no
ChallengeResponseAuthentication no
UsePAM yes

# Security
X11Forwarding {{ security_config.ssh.x11_forwarding | default('no') }}
AllowTcpForwarding {{ security_config.ssh.tcp_forwarding | default('no') }}
AllowAgentForwarding {{ security_config.ssh.agent_forwarding | default('no') }}
MaxAuthTries {{ security_config.ssh.max_auth_tries | default(3) }}
MaxSessions {{ security_config.ssh.max_sessions | default(4) }}
ClientAliveInterval {{ security_config.ssh.client_alive_interval | default(300) }}
ClientAliveCountMax {{ security_config.ssh.client_alive_count_max | default(3) }}

# Ciphers and algorithms
Ciphers {{ security_config.ssh.ciphers | default('chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr') }}
MACs {{ security_config.ssh.macs | default('hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com,umac-128-etm@openssh.com') }}
KexAlgorithms {{ security_config.ssh.kex_algorithms | default('curve25519-sha256@libssh.org,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512') }}

# Logging
SyslogFacility AUTH
LogLevel {{ security_config.ssh.log_level | default('VERBOSE') }}

# Banner
Banner {{ security_config.ssh.banner_path | default('/etc/issue.net') }} 
