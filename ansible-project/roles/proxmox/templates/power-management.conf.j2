# {{ ansible_managed }}
# Power Management Configuration for Proxmox VE
# Last modified: {{ ansible_date_time.iso8601 }}
#
# Note: This configuration manages power settings for CPU, PCIe, USB, disks, and network interfaces.
# For more information, visit: https://pve.proxmox.com/wiki/Host_System_Administration#Power_Management

# CPU Power Management
# Valid options: performance, powersave, ondemand, conservative, schedutil
CPU_GOVERNOR="{{ proxmox_power.cpu_governor | default('performance') }}"

# PCIE ASPM Policy
# Valid options: default, performance, powersave, powersupersave
PCIE_ASPM_POLICY="{{ proxmox_power.pcie_aspm_policy | default('performance') }}"

# USB Autosuspend
# Valid options: enabled, disabled
USB_AUTOSUSPEND="{{ 'enabled' if proxmox_power.usb_autosuspend | default(false) else 'disabled' }}"

# Disk Power Management
# -----------------------------------------------------------------------------
{% for disk in proxmox_power.disks | default([]) %}
# Disk: {{ disk.name }}
# Power control: on, off
DISK_{{ disk.name | upper }}_POWER="{{ disk.power_control | default('on') }}"
# Scheduler: none, mq-deadline, bfq, kyber
DISK_{{ disk.name | upper }}_SCHEDULER="{{ disk.scheduler | default('none') }}"
{% endfor %}

# Network Interface Power Management
# -----------------------------------------------------------------------------
{% for interface in proxmox_power.network_interfaces | default([]) %}
# Interface: {{ interface.name }}
# Power control: on, off
NET_{{ interface.name | upper }}_POWER="{{ interface.power_control | default('on') }}"
{% endfor %}

# Thermal Management
# Valid options: enabled, disabled
THERMAL_MODE="{{ proxmox_power.thermal_mode | default('enabled') }}"

# Fan Control
# Valid options: auto, manual
FAN_MODE="{{ proxmox_power.fan_mode | default('auto') }}" 
